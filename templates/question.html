<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello, Smarty Pants: Question {{ current_question_num }}</title>
    <link rel="stylesheet" href="https://use.typekit.net/qcr5acn.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="min-h-screen bg-light-blue">
    <div id="question-content" class="flex flex-col justify-center items-center min-h-screen p-4 md:p-8 text-center">
        <div class="max-w-3xl mx-auto text-center">
            <!-- COUNTER -->
            <h1 class="font-segoe text-lg md:text-xl text-warm-black mb-4">
                Question {{ current_question_num }} of {{ total_questions }}
            </h1>
            
            <!-- QUESTION -->
            <h2 class="font-rockwell text-2xl md:text-4xl lg:text-5xl font-bold text-yellow leading-tight mb-8">
                {{ question_data.question }}
            </h2>
            
            <!-- ANSWER OPTIONS -->
            <form id="answer-form" class="space-y-4">
                {% for i, answer in enumerate(question_data.answers) %}
                <div class="answer-option">
                    <input 
                        type="radio" 
                        name="answer" 
                        value="{{ i }}" 
                        id="answer{{ i }}"
                        class="sr-only answer-radio"
                    >
                    <label 
                        for="answer{{ i }}" 
                        class="block w-full p-4 md:p-6 bg-yellow text-warm-black font-segoe text-base md:text-lg lg:text-xl rounded-lg cursor-pointer hover:bg-opacity-80 transition-all duration-300 ease border-4 border-transparent answer-label hover:-translate-y-0.5 hover:shadow-lg"
                    >
                        {{ answer }}
                    </label>
                </div>
                {% endfor %}
            </form>
            
            <!-- Current score display -->
            <p id="score-display" class="font-segoe text-base md:text-lg text-warm-black mt-8">
                Current score: {{ session.get('score', 0) }}/{{ current_question_num - 1 if current_question_num > 1 else 0 }}
            </p>
        </div>
    </div>

        
        <div class="text-right">
            <a href="{{ url_for('home') }}" class="text-red font-segoe no-underline text-base hover:underline">&larr; Take me home</a>
        </div>
    </div>

    <script>
        // JAVASCRIPT FOR ANSWERS AND DYNAMIC USER MESSAGE DISPLAY
        
        // ELEMENTS
        const form = document.getElementById('answer-form');
        const overlay = document.getElementById('feedback-overlay');
        const feedbackBox = document.getElementById('feedback-box');
        const feedbackMessage = document.getElementById('feedback-message');
        const scoreUpdate = document.getElementById('score-update');
        const scoreDisplay = document.getElementById('score-display');
        const answerRadios = document.querySelectorAll('.answer-radio');
        const answerLabels = document.querySelectorAll('.answer-label');

        // CLICK STYLING
        answerLabels.forEach(label => {
            label.addEventListener('click', function() {
                answerLabels.forEach(l => {
                    l.classList.remove('border-red', 'bg-opacity-90', 'ring-4', 'ring-red', 'ring-opacity-20');
                    l.classList.add('border-transparent');
                });
                this.classList.add('border-red', 'bg-opacity-90', 'ring-4', 'ring-red', 'ring-opacity-20');
                this.classList.remove('border-transparent');
                submitAnswer();
            });
        });

        // ANSWER PROCESSING    
        function submitAnswer() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (!selectedAnswer) {
                return;
            }

            answerRadios.forEach(radio => radio.disabled = true);
            answerLabels.forEach(label => {
                label.classList.remove('hover:bg-opacity-80', 'cursor-pointer', 'hover:-translate-y-0.5', 'hover:shadow-lg');
                label.classList.add('opacity-50', 'cursor-not-allowed');
            });

            const formData = new FormData();
            formData.append('answer', selectedAnswer.value);

            fetch('/answer', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.redirect) {
                    window.location.href = data.redirect;
                    return;
                }
                showFeedback(data);
                
                setTimeout(() => {
                    if (data.has_more_questions) {
                        window.location.reload();
                    } else {
                        window.location.href = '/results';
                    }
                }, 3000);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Something went wrong. Please try again.');
                answerRadios.forEach(radio => radio.disabled = false);
                answerLabels.forEach(label => {
                    label.classList.add('hover:bg-opacity-80', 'cursor-pointer', 'hover:-translate-y-0.5', 'hover:shadow-lg');
                    label.classList.remove('opacity-50', 'cursor-not-allowed');
                });
            });
        }

        // USER FEEDBACK MESSAGE OVERLAY
        function showFeedback(data) {
            
            feedbackMessage.innerHTML = data.feedback_message;
            scoreUpdate.textContent = `Current score: ${data.current_score}/${data.current_question_num}`;
            
            overlay.classList.remove('hidden');
            
            setTimeout(() => {
                feedbackBox.classList.remove('scale-0');
                feedbackBox.classList.add('scale-100');
            }, 50);
            
            setTimeout(() => {
                feedbackBox.classList.remove('scale-100');
                feedbackBox.classList.add('scale-75');
            }, 2500);
        }
    </script>
</body>
</html>